<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Learning Report: SimCLR & VAE (Exp Data)</title>
    <link rel="stylesheet" href="presentation.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

    <div class="controls">
        <button id="btn-prev" class="nav-btn" aria-label="Previous Slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
        </button>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <button id="btn-next" class="nav-btn" aria-label="Next Slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
            </svg>
        </button>
        <button id="btn-autoplay" class="nav-btn" aria-label="Toggle Autoplay">
            <svg id="icon-play" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
             <svg id="icon-pause" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        </button>
    </div>

    <div class="slides-container" id="slides-container">

        <!-- Slide 1: Experiment Overview -->
        <div class="slide active" data-type="title">
            <div class="slide-content center">
                <div class="badge animate-reveal">EXPERIMENT OVERVIEW</div>
                <h1 style="margin-top: 20px;" class="animate-reveal">机器学习实验汇报：<br>特征提取与模型生成</h1>
                <p class="hero-desc animate-fade-up">基于 MindSpore 框架的 SimCLR 与 VAE 算法复现</p>
                
                <div class="title-info-grid animate-fade-up">
                    <div class="info-item"><span class="label">Task 1</span><span class="value">SimCLR 自监督学习</span></div>
                    <div class="info-item"><span class="label">Task 2</span><span class="value">VAE 变分自编码器</span></div>
                    <div class="info-item"><span class="label">Framework</span><span class="value">MindSpore 2.2.0</span></div>
                    <div class="info-item"><span class="label">Hardware</span><span class="value">Ascend 910 Pro</span></div>
                </div>

                <div class="collaborators-pill-cluster animate-fade-up" style="margin-top: 40px;">
                    <span class="badge" style="background: #f1f3f4; color: #5f6368; margin: 0 5px;">zym: 整体框架</span>
                    <span class="badge" style="background: #f1f3f4; color: #5f6368; margin: 0 5px;">wyk: 架构设计</span>
                    <span class="badge" style="background: #f1f3f4; color: #5f6368; margin: 0 5px;">tzr: 算法原理</span>
                    <span class="badge" style="background: #f1f3f4; color: #5f6368; margin: 0 5px;">pwc: 结果分析</span>
                </div>
            </div>
        </div>

        <!-- Slide 2: Architecture Overview -->
        <div class="slide" data-type="overview">
            <div class="slide-content">
                <div class="badge">SECTION 02</div>
                <h2>关键模型架构：双模型并行</h2>
                <p class="slide-subtitle">基于 CIFAR-10 的 SimCLR 自监督表征 + VAE 生成建模（MindSpore 复现）</p>

                <div class="dual-card-grid">
                    <div class="arch-card arch-simclr" style="--offset: -100px; --delay: 0.1s;">
                        <div class="arch-header">
                            <span class="arch-chip simclr">SimCLR</span>
                            <span class="arch-tag">Task 1</span>
                        </div>
                        <p class="arch-desc">对比学习强调视图不变性，学习稳定的语义表征。</p>
                        <div class="arch-rows">
                            <div class="arch-row"><span class="arch-label">Encoder</span><span class="arch-value">ResNet + GroupNorm</span></div>
                            <div class="arch-row"><span class="arch-label">Projection</span><span class="arch-value">2-layer MLP</span></div>
                            <div class="arch-row"><span class="arch-label">Loss</span><span class="arch-value">NT-Xent</span></div>
                        </div>
                        <div class="arch-flow">
                            <span class="flow-pill">Input</span>
                            <span class="flow-arrow">→</span>
                            <span class="flow-pill">Augment</span>
                            <span class="flow-arrow">→</span>
                            <span class="flow-pill">Encoder</span>
                            <span class="flow-arrow">→</span>
                            <span class="flow-pill">Projection</span>
                        </div>
                    </div>
                    <div class="arch-card arch-vae" style="--offset: 100px; --delay: 0.2s;">
                        <div class="arch-header">
                            <span class="arch-chip vae">VAE</span>
                            <span class="arch-tag">Task 2</span>
                        </div>
                        <p class="arch-desc">潜在空间采样生成，重构损失与 KL 散度共同约束。</p>
                        <div class="arch-rows">
                            <div class="arch-row"><span class="arch-label">Encoder</span><span class="arch-value">Conv + BatchNorm</span></div>
                            <div class="arch-row"><span class="arch-label">Latent</span><span class="arch-value">Reparameterize</span></div>
                            <div class="arch-row"><span class="arch-label">Decoder</span><span class="arch-value">ConvTranspose</span></div>
                        </div>
                        <div class="arch-flow">
                            <span class="flow-pill">Encode</span>
                            <span class="flow-arrow">→</span>
                            <span class="flow-pill">&mu;, &sigma;</span>
                            <span class="flow-arrow">→</span>
                            <span class="flow-pill">Sample z</span>
                            <span class="flow-arrow">→</span>
                            <span class="flow-pill">Decode</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3: SimCLR Encoder -->
        <div class="slide" data-type="code">
            <div class="slide-content split-layout">
                <div class="text-col">
                    <div class="badge">SimCLR Encoder</div>
                    <h2>适配小 Batch 的 GroupNorm</h2>
                    <p class="slide-subtitle">CIFAR-10 训练 BatchSize=32，GroupNorm 让归一化不依赖 batch 统计。</p>
                    <ul class="checklist">
                        <li><b>稳定性:</b> 小 batch 下均值/方差更平稳。</li>
                        <li><b>泛化:</b> 组内统计减少噪声放大。</li>
                        <li><b>配置:</b> 64 通道分 8 组。</li>
                    </ul>
                </div>
                <div class="code-col">
                    <div class="code-card">
                        <div class="code-header">
                            <span class="code-file">simclr_encoder.py</span>
                            <span class="code-meta">GroupNorm(8, 64)</span>
                        </div>
                        <div class="code-body">
                            <div class="code-line" style="--delay: 0.1s;"><span class="code-accent">class</span> CNNEncoder(nn.Cell):</div>
                            <div class="code-line" style="--delay: 0.2s;"><span class="code-indent"></span><span class="code-accent">def</span> __init__(self, out_dim=256):</div>
                            <div class="code-line" style="--delay: 0.3s;"><span class="code-indent"></span><span class="code-indent"></span>self.features = nn.SequentialCell([</div>
                            <div class="code-line" style="--delay: 0.4s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span>nn.Conv2d(3, 64, kernel_size=3, padding=1),</div>
                            <div class="code-line" style="--delay: 0.5s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span><span class="code-highlight">nn.GroupNorm(8, 64)</span>,</div>
                            <div class="code-line" style="--delay: 0.6s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span>nn.ReLU(),</div>
                            <div class="code-line code-dim" style="--delay: 0.7s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span># ... 后续下采样层 ...</div>
                            <div class="code-line" style="--delay: 0.8s;"><span class="code-indent"></span><span class="code-indent"></span>])</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: SimCLR Projection Head -->
        <div class="slide" data-type="code">
            <div class="slide-content split-layout">
                <div class="text-col">
                    <div class="badge">SimCLR Projection</div>
                    <h2>投影头：特征空间的非线性转换</h2>
                    <p class="slide-subtitle">两层 MLP 将语义特征映射到紧凑嵌入空间，提升对比鲁棒性。</p>
                    <ul class="checklist">
                        <li><b>输入维度:</b> 256 维编码表征。</li>
                        <li><b>归一化:</b> LayerNorm 稳定嵌入尺度。</li>
                        <li><b>输出维度:</b> 128 维对比空间。</li>
                    </ul>
                </div>
                <div class="code-col">
                    <div class="code-card">
                        <div class="code-header">
                            <span class="code-file">simclr_projection.py</span>
                            <span class="code-meta">MLP + LayerNorm</span>
                        </div>
                        <div class="code-body">
                            <div class="code-line" style="--delay: 0.1s;"><span class="code-accent">class</span> <span class="code-accent">ProjectionHead</span>(nn.Cell):</div>
                            <div class="code-line" style="--delay: 0.2s;"><span class="code-indent"></span><span class="code-accent">def</span> __init__(self, in_dim, proj_dim=128):</div>
                            <div class="code-line" style="--delay: 0.3s;"><span class="code-indent"></span><span class="code-indent"></span>self.net = nn.SequentialCell([</div>
                            <div class="code-line" style="--delay: 0.4s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span>nn.Dense(in_dim, in_dim),</div>
                            <div class="code-line" style="--delay: 0.5s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span><span class="code-underline">nn.LayerNorm((in_dim,))</span>,</div>
                            <div class="code-line" style="--delay: 0.6s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span>nn.ReLU(),</div>
                            <div class="code-line" style="--delay: 0.7s;"><span class="code-indent"></span><span class="code-indent"></span><span class="code-indent"></span>nn.Dense(in_dim, proj_dim)</div>
                            <div class="code-line" style="--delay: 0.8s;"><span class="code-indent"></span><span class="code-indent"></span>])</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 5: VAE Reparameterization -->
        <div class="slide" data-type="analysis">
            <div class="slide-content">
                <div class="badge">VAE Core</div>
                <h2>重参数化：让采样可微</h2>
                <p class="slide-subtitle">通过噪声分离，使梯度绕过随机采样并回传到 Encoder。</p>

                <div class="analysis-grid">
                    <div class="formula-card" style="--delay: 0.1s;">
                        <div class="formula-title">数学表达</div>
                        <div class="formula-body">
                            \[ z = \mu + \sigma \odot \epsilon \]
                        </div>
                        <p class="formula-note">将随机性放在 \(\epsilon\) 上，保证 \(\mu, \sigma\) 可微。</p>
                    </div>
                    <div class="code-card" style="--delay: 0.2s;">
                        <div class="code-header">
                            <span class="code-file">vae_reparam.py</span>
                            <span class="code-meta">Reparameterize</span>
                        </div>
                        <div class="code-body">
                            <div class="code-line" style="--delay: 0.2s;"><span class="code-accent">def</span> reparameterize(self, mu, logvar):</div>
                            <div class="code-line" style="--delay: 0.3s;"><span class="code-indent"></span>std = ops.exp(0.5 * logvar)</div>
                            <div class="code-line" style="--delay: 0.4s;"><span class="code-indent"></span>eps = ops.<span class="code-focus">standard_normal</span>(mu.shape)</div>
                            <div class="code-line" style="--delay: 0.5s;"><span class="code-indent"></span><span class="code-pop">z = mu + eps * std</span></div>
                            <div class="code-line" style="--delay: 0.6s;"><span class="code-indent"></span>return z</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: Strong Augmentation -->
        <div class="slide" data-type="code">
            <div class="slide-content split-layout">
                <div class="text-col">
                    <div class="badge">SECTION 03</div>
                    <h2>SimCLR 优化：强数据增强</h2>
                    <p class="slide-subtitle">随机裁剪、翻转与颜色抖动构造困难正样本对，逼迫模型关注结构。</p>
                    <ul class="checklist">
                        <li><b>RandomResizedCrop:</b> 强化局部视角。</li>
                        <li><b>Flip & Jitter:</b> 弱化颜色偏置。</li>
                        <li><b>Normalize:</b> 统一数值尺度。</li>
                    </ul>
                    <div class="augmentation-chips">
                        <span class="aug-chip">Crop</span>
                        <span class="aug-chip">Flip</span>
                        <span class="aug-chip">Brightness</span>
                        <span class="aug-chip">Normalize</span>
                    </div>
                </div>
                <div class="code-col">
                    <div class="code-card flicker" style="--delay: 0.1s;">
                        <div class="code-header">
                            <span class="code-file">data_augmentation.py</span>
                            <span class="code-meta">Strong Augment</span>
                        </div>
                        <div class="code-body">
                            <div class="code-line" style="--delay: 0.1s;"><span class="code-accent">def</span> simclr_augment(image):</div>
                            <div class="code-line code-dim" style="--delay: 0.2s;"><span class="code-indent"></span># 组合多种强增强策略</div>
                            <div class="code-line" style="--delay: 0.3s;"><span class="code-indent"></span>img = <span class="code-highlight">random_resized_crop</span>(img)</div>
                            <div class="code-line" style="--delay: 0.4s;"><span class="code-indent"></span><span class="code-accent">if</span> random.random() &lt; 0.5:</div>
                            <div class="code-line" style="--delay: 0.5s;"><span class="code-indent"></span><span class="code-indent"></span>img = img.transpose(Image.FLIP_LEFT_RIGHT)</div>
                            <div class="code-line" style="--delay: 0.6s;"><span class="code-indent"></span><span class="code-accent">if</span> random.random() &lt; 0.8:</div>
                            <div class="code-line code-dim" style="--delay: 0.7s;"><span class="code-indent"></span><span class="code-indent"></span># 颜色抖动：亮度、对比度、饱和度</div>
                            <div class="code-line" style="--delay: 0.8s;"><span class="code-indent"></span><span class="code-indent"></span>img = <span class="code-underline">ImageEnhance.Brightness</span>(img).enhance(random.uniform(0.6, 1.4))</div>
                            <div class="code-line" style="--delay: 0.9s;"><span class="code-indent"></span><span class="code-accent">return</span> normalize(np.array(img))</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 7: NT-Xent Loss -->
        <div class="slide" data-type="analysis">
            <div class="slide-content split-layout">
                <div class="text-col">
                    <div class="badge">NT-Xent</div>
                    <h2>对比损失：屏蔽自相似项</h2>
                    <p class="slide-subtitle">2N 样本相似度矩阵中，对角线用极大负值遮盖，避免模型“偷懒”。</p>
                    <div class="matrix-card" style="--delay: 0.2s;">
                        <div class="matrix-header">Similarity Matrix (2N × 2N)</div>
                        <div class="matrix-grid">
                            <span class="matrix-cell diag"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell diag"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell diag"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell diag"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell diag"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell"></span>
                            <span class="matrix-cell diag"></span>
                        </div>
                        <div class="matrix-legend">
                            <span class="legend-chip diag">Masked Diagonal</span>
                            <span class="legend-chip">Positive/Negative Pairs</span>
                        </div>
                    </div>
                </div>
                <div class="code-col">
                    <div class="code-card" style="--delay: 0.1s;">
                        <div class="code-header">
                            <span class="code-file">nt_xent_logic.py</span>
                            <span class="code-meta">Contrastive Loss</span>
                        </div>
                        <div class="code-body">
                            <div class="code-line" style="--delay: 0.1s;"><span class="code-accent">def</span> nt_xent_loss(z1, z2, temperature=0.5):</div>
                            <div class="code-line code-dim" style="--delay: 0.2s;"><span class="code-indent"></span># 计算余弦相似度矩阵</div>
                            <div class="code-line" style="--delay: 0.3s;"><span class="code-indent"></span>similarity = ops.matmul(z, z.T) / temperature</div>
                            <div class="code-line code-dim" style="--delay: 0.4s;"><span class="code-indent"></span># 屏蔽对角线（自相似项）</div>
                            <div class="code-line" style="--delay: 0.5s;"><span class="code-indent"></span>logits = <span class="code-highlight">similarity - 1e9 * ops.eye(2 * batch_size)</span></div>
                            <div class="code-line code-dim" style="--delay: 0.6s;"><span class="code-indent"></span># 计算交叉熵，最大化正样本对相似度</div>
                            <div class="code-line" style="--delay: 0.7s;"><span class="code-indent"></span><span class="code-block-highlight">loss = -ops.log(ops.exp(pos / temperature) / denom)</span></div>
                            <div class="code-line" style="--delay: 0.8s;"><span class="code-indent"></span><span class="code-accent">return</span> ops.mean(loss)</div>
                        </div>
                        <div class="code-note">Masking Self-Similarity prevents trivial collapse.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 8: KL Annealing -->
        <div class="slide" data-type="analysis">
            <div class="slide-content">
                <div class="badge">VAE Optimization</div>
                <h2>KL Annealing：逐步加权 KL 散度</h2>
                <p class="slide-subtitle">Warmup 让模型先学会重构，再逐步收紧潜在分布。</p>

                <div class="analysis-grid">
                    <div class="formula-card gradient" style="--delay: 0.1s;">
                        <div class="formula-title">Beta Schedule</div>
                        <div class="formula-body">
                            \[ \beta = \beta_{min} + (\beta_{max} - \beta_{min}) \cdot \text{ramp} \]
                        </div>
                        <p class="formula-note">线性 warmup 防止 encoder 早期塌陷。</p>
                    </div>
                    <div class="code-card" style="--delay: 0.2s;">
                        <div class="code-header">
                            <span class="code-file">kl_annealing.py</span>
                            <span class="code-meta">Beta Ramp</span>
                        </div>
                        <div class="code-body">
                            <div class="code-line code-dim" style="--delay: 0.2s;"># 训练循环中的 Beta 调度 (KL Annealing)</div>
                            <div class="code-line" style="--delay: 0.3s;">progress = global_step / max(1, total_steps - 1)</div>
                            <div class="code-line code-dim" style="--delay: 0.4s;"># 线性增加 KL 散度的权重，防止训练初期塌陷</div>
                            <div class="code-line" style="--delay: 0.5s;"><span class="code-focus">ramp</span> = progress * (1 / WARMUP_RATIO) if progress &lt; WARMUP_RATIO else 1.0</div>
                            <div class="code-line" style="--delay: 0.6s;"><span class="code-click">beta = MIN_BETA + (MAX_BETA - MIN_BETA) * ramp</span></div>
                            <div class="code-line" style="--delay: 0.7s;">total_loss = recon_loss + beta * kl_loss</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="presentation.js"></script>
</body>
</html>
