# Section 03: 优化算法与损失函数 (Optimization & Loss)

---

## [SLIDE 6]: SimCLR 优化：强数据增强 (Strong Augmentation)
### 页面配置
- **布局**: 左文右码
- **动画**: 代码块入场时带有闪烁效果，突出组合增强的逻辑。

### 内容说明
- **设计逻辑**: 对比学习的核心在于构造困难的正样本对。通过随机裁剪、色彩抖动和灰度化，模型被逼迫学习图像的结构特征而非简单的颜色分布。
- **关键代码**:
```python
# 文件: data_augmentation.py
# 动画:
# 1. 自动选中 [random_resized_crop] 并伴随轻微放大效果
# 2. 划线强调 [ImageEnhance.Brightness]
```
- **解释**: 多种增强手段的链式调用，是 SimCLR 能够学到语义一致性特征的基石。

---

## [SLIDE 7]: SimCLR 损失：NT-Xent 对比损失实现
### 页面配置
- **重点**: 矩阵运算实现高效对比。
- **视觉**: 矩阵示意图与代码卡片联动。

### 内容说明
- **算法核心**: 将 $2N$ 个增强样本两两计算余弦相似度，并利用 `1e9` 极其大的负值屏蔽对角线，确保模型只对比不同的样本。
- **关键代码**:
```python
# 文件: nt_xent_logic.py
# 动画:
# 1. 荧光笔涂抹高亮 [similarity - 1e9 * ops.eye]
# 2. “选中”整个 [loss = -ops.log(...)] 逻辑块并浮现文字说明
```
- **解释**: 屏蔽自相似项（Masking Self-Similarity）是防止模型退化解的关键步骤。

---

## [SLIDE 8]: VAE 优化：KL 散度退火 (KL Annealing)
### 页面配置
- **重点**: 训练动态调整 Beta 参数。
- **视觉**: 带有渐变背景的公式卡片。

### 内容说明
- **设计逻辑**: 训练初期如果 KL 权重过大，Encoder 会迅速塌陷至标准正态分布。通过线性 `warmup` 逐渐增加 $\beta$，平衡重构精度与潜在空间的分布特性。
- **关键代码**:
```python
# 文件: kl_annealing.py
# 动画:
# 1. 模拟鼠标点击 [beta = MIN_BETA + ...] 所在行，使其变色高亮
# 2. 变量 [ramp] 在计算过程中带有动态呼吸灯效果
```
- **解释**: KL 退火是 VAE 在 CIFAR 这种复杂数据集上成功重构的关键策略。